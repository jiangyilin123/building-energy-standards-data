# majority adapt from https://dev.to/moaaz_adel/github-actions-a-simple-way-to-trigger-workflow-from-another-workflow-1b55
name: Trigger OpenStudio Standards GitHub Action to Update Data
run-name: ${{github.actor}} is triggering GitHub Action in OSSTD
on: [push] # TODO: to be modified later with PR merge
jobs:
  trigger-osstd-update:
    name: Trigger OpenStudio GitHub Action to initiate a PR there with data update pulling data from here.
    runs-on: 'ubuntu-latest'
    steps:
        - name: Update Data
          run: |
            git clone https://github.com/pnnl/building-energy-standards-data.git
            cd building-energy-standards-data
            git checkout cross_repo_actions
            cd osstd_data_update
            export COMMIT_ID=${{ github.sha }}
            export GHTOKEN=${{ secrets.JERRY_ACTIONS_KEY }}
            ./run.sh
        # TODO: remove git checkout cross_repo_actions before merge to develop

        - name: GitHub API to trigger PR
          run: |
            curl -L \
            -X POST \
            -H "Accept: application/vnd.github+json" \
            -H "Authorization: Bearer ${{ secrets.JERRY_ACTIONS_KEY }}" \
            -H "X-GitHub-Api-Version: 2022-11-28" \
            https://api.github.com/repos/pnnl/building-energy-standards-data/pulls \
            -d '{"title":"Pull Data from building-energy-standards-data repo","body":"Commit ID: ${{ github.sha }} Pull request overview\n---------------------\n\n<!--- DESCRIBE PURPOSE OF THIS PULL REQUEST -->\n\n - Fixes #ISSUENUMBERHERE (IF THIS IS A DEFECT)\n\n### Pull Request Author\n\n<!--- Add to this list or remove from it as applicable.  This is a simple templated set of guidelines. -->\n\n - [ ] Method changes or additions\n - [ ] Data changes or additions\n - [ ] Added tests for added methods\n - [ ] If methods have been deprecated, update rest of code to use the new methods\n - [ ] Documented new methods using [yard syntax](https://rubydoc.info/gems/yard/file/docs/GettingStarted.md)\n - [ ] Resolved yard documentation errors for new code (ran `bundle exec rake doc`)\n - [ ] Resolved rubocop syntax errors for new code (ran `bundle exec rake rubocop`)\n - [ ] All new and existing tests passes\n - [ ] If the code adds new `require` statements, ensure these are in core ruby or add to the gemspec\n\n### Review Checklist\n\nThis will not be exhaustively relevant to every PR.\n - [ ] Perform a code review on GitHub\n - [ ] All related changes have been implemented: method additions, changes, tests\n - [ ] Check rubocop errors\n - [ ] Check yard doc errors\n - [ ] If fixing a defect, verify by running develop branch and reproducing defect, then running PR and reproducing fix\n - [ ] If a new feature, test the new feature and try creative ways to break it\n - [ ] CI status: all green or justified\n\n","head":"bes:data-update","base":"develop"}'
